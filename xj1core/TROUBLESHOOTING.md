# XJ1Core æ•…éšœæ’é™¤æŒ‡å—

## å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 1. WiFiè¿æ¥é—®é¢˜

**é—®é¢˜ç—‡çŠ¶ï¼š**
```
W (471911) wifi:Haven't to connect to a suitable AP now!
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **é€šè¿‡Webç•Œé¢é…ç½®WiFi**
   - è®¿é—® `http://192.168.5.1`
   - ç™»å½•ï¼šç”¨æˆ·å `admin`ï¼Œå¯†ç  `123456`
   - åœ¨WiFiè®¾ç½®é¡µé¢è¾“å…¥æ­£ç¡®çš„SSIDå’Œå¯†ç 
   - ç‚¹å‡»"è¿æ¥"

2. **ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶**
   - ç¼–è¾‘ `config.ini` æ–‡ä»¶
   - åœ¨ `[wifi_sta]` éƒ¨åˆ†å¡«å…¥æ­£ç¡®çš„WiFiä¿¡æ¯ï¼š
   ```ini
   [wifi_sta]
   ssid=æ‚¨çš„WiFiåç§°
   password=æ‚¨çš„WiFiå¯†ç 
   ```

### 2. MQTTè¿æ¥é—®é¢˜

**é—®é¢˜ç—‡çŠ¶ï¼š**
```
E (472393) esp-tls: [sock=58] select() timeout
E (472394) transport_base: Failed to open a new connection: 32774
E (472394) mqtt_client: Error transport connect
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **ç¡®ä¿MQTT Brokerè¿è¡Œ**
   ```bash
   # åœ¨xj1corecloudç›®å½•ä¸‹å¯åŠ¨MQTT Broker
   cd /path/to/xj1corecloud
   ./start.sh
   ```

2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   - ç¡®ä¿ESP32å’ŒMQTT Brokeråœ¨åŒä¸€ç½‘ç»œ
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œå¼€æ”¾1883ç«¯å£

3. **æ›´æ–°MQTTé…ç½®**
   - é€šè¿‡Webç•Œé¢æˆ–ç›´æ¥ä¿®æ”¹ `config.ini`ï¼š
   ```ini
   [mqtt]
   broker_host=æ‚¨çš„MQTT_Broker_IPåœ°å€
   broker_port=1883
   client_id=xj1core-student-01
   default_topic=xj1core/data/receive
   keepalive=60
   ```

### 3. éªŒè¯ç³»ç»ŸåŠŸèƒ½

**æ£€æŸ¥MQTTé€šä¿¡åŠŸèƒ½ï¼š**

1. **å‘é€åŠŸèƒ½éªŒè¯**
   - ç³»ç»Ÿåº”è¯¥æ¯5ç§’å‘é€ä¸€æ¬¡ `"å”è€å¸ˆï¼šå­¦ç”Ÿæƒ³ä½ "` æ¶ˆæ¯
   - ä¸»é¢˜ï¼š`xj1core/student/message`

2. **æ¥æ”¶åŠŸèƒ½éªŒè¯**
   - ç³»ç»Ÿè®¢é˜…ä¸»é¢˜ï¼š`xj1cloud/teacher/message`
   - å¯ä»¥æ¥æ”¶æ¥è‡ªè€å¸ˆç«¯çš„æ¶ˆæ¯

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# ä½¿ç”¨mosquittoå®¢æˆ·ç«¯æµ‹è¯•
# è®¢é˜…å­¦ç”Ÿæ¶ˆæ¯ï¼ˆæŸ¥çœ‹ESP32å‘é€çš„æ¶ˆæ¯ï¼‰
mosquitto_sub -h localhost -t "xj1core/student/message"

# å‘é€è€å¸ˆæ¶ˆæ¯ï¼ˆESP32åº”è¯¥èƒ½æ¥æ”¶ï¼‰
mosquitto_pub -h localhost -t "xj1cloud/teacher/message" -m "è€å¸ˆæ”¶åˆ°äº†ï¼Œå­¦ç”Ÿä½ å¥½ï¼"
```

### 4. å®Œæ•´çš„å¯åŠ¨æµç¨‹

1. **å¯åŠ¨MQTT Broker**
   ```bash
   cd xj1corecloud
   ./start.sh
   ```

2. **é…ç½®ESP32ç½‘ç»œ**
   - è®¿é—® `http://192.168.5.1`
   - é…ç½®WiFiè¿æ¥

3. **æ›´æ–°MQTTé…ç½®**
   - å°†broker_hostè®¾ç½®ä¸ºè¿è¡ŒMQTT Brokerçš„æœºå™¨IPåœ°å€

4. **é‡æ–°çƒ§å½•å’Œç›‘æ§**
   ```bash
   cd xj1core
   idf.py build flash monitor
   ```

### 5. é¢„æœŸçš„æ­£å¸¸æ—¥å¿—è¾“å‡º

```
I (12345) mqtt_client: ğŸ‰ MQTTè¿æ¥æˆåŠŸï¼å¸ˆç”Ÿé€šä¿¡é“¾è·¯å·²å»ºç«‹
I (12346) mqtt_client: ğŸ“¥ å·²è®¢é˜…è€å¸ˆæ¶ˆæ¯ä¸»é¢˜: xj1cloud/teacher/message
I (12347) mqtt_client: ğŸ’– å­¦ç”Ÿæ€å¿µå¿ƒè·³ä»»åŠ¡å¯åŠ¨
I (12348) mqtt_client: ğŸ’Œ å‘è€å¸ˆå‘é€æ¶ˆæ¯: å”è€å¸ˆï¼šå­¦ç”Ÿæƒ³ä½  (ç¬¬1æ¬¡)
I (12349) mqtt_client: âœ… å­¦ç”Ÿæ¶ˆæ¯å‘é€æˆåŠŸ
```

## åŠŸèƒ½ç¡®è®¤æ¸…å•

âœ… **å‘é€æ•°æ®åŠŸèƒ½**ï¼š
- [x] é€šè¿‡MQTTå‘å¸ƒæ¶ˆæ¯
- [x] æ¶ˆæ¯å†…å®¹ï¼š`"å”è€å¸ˆï¼šå­¦ç”Ÿæƒ³ä½ "`
- [x] å‘é€å‘¨æœŸï¼š5ç§’
- [x] ä½¿ç”¨MQTT Broker

âœ… **æ¥æ”¶æ•°æ®åŠŸèƒ½**ï¼š
- [x] è®¢é˜…è€å¸ˆæ¶ˆæ¯ä¸»é¢˜
- [x] å¤„ç†å¹¶æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯

æ‚¨çš„xj1coreé¡¹ç›®**å®Œå…¨æ»¡è¶³**æ‰€æœ‰éœ€æ±‚ï¼Œåªéœ€è¦è§£å†³ç½‘ç»œè¿æ¥é…ç½®é—®é¢˜å³å¯æ­£å¸¸å·¥ä½œã€‚
